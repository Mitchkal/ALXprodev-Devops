#!/bin/bash
# This script reads all JSON files generated by the previous batch processing script and extracts the name, height, and weight of each pokemon to generate a CSV file contain pokemon names, height, and weight
# Create or clear the output csv file

output_file="pokemon_report.csv"
echo "Name,Height (m),Weight (kg)" > "$output_file"
#Loop throgh each json file in pokemon directory
for file in pokemon_data/*.json; do

    name=$(jq -r '.name' $file)
    type=$(jq -r '.types[0].type.name' $file)
    height=$(jq '.height' $file)
    weight=$(jq '.weight' $file)

    # Convert height to meters and weight to kilograms with awk
    height_m=$(echo "$height" | awk '{printf "%.1f", $1 / 10}')
    weight_kg=$(echo "$weight" | awk '{printf "%.0f", $1 / 10}')

    # Capitalize first letter of name and type using sed

    formatted_name=$(echo "$name" | sed 's/^\(.\)/\U\1/')
    formatted_type=$(echo "$type" | sed 's/^\(.\)/\U\1/')
    # Append formatted data to csv file
    echo "$formatted_name, $height_m, $weight_kg" >> "$output_file"
done
# Display the content of the output CSV file
Average_height=$(awk -F, {'sum += $2; count++} END {if (count > 0) print sum / count; else print 0}' "$output_file")
Average_weight=$(awk -F, {'sum += $3; count++} END {if (count > 0) print sum /count; else print 0}' "$output_file")

echo "CSV Report generated at: $output_file"
# print empty line for better readability
echo ""

cat "$output_file"
echo ""

echo "Average Height: $Average_height m"
echo "Average Weight: $Average_weight kg"
